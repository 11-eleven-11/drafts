#!/usr/bin/env node

const { readFileSync, writeFileSync } = require('fs')
const { template } = require('lodash')
const { resolve } = require('path')

const jsTemplate = readFileSync(
  resolve(__dirname, '../final.js.template'),
  'utf-8'
)
const typings = readFileSync(
  resolve(__dirname, '../definitions/drafts.d.ts'),
  'utf-8'
)
const es6 = readFileSync(
  resolve(__dirname, '../definitions/es6.d.ts'),
  'utf-8'
).replace(/`/g, '\\`')
const js = readFileSync(resolve(__dirname, '../index.js'), 'utf-8').replace(
  "const monaco = require('monaco-editor')",
  ''
) // don't keep the require in the output

const output = template(jsTemplate)({
  typings,
  js,
  es6
})
writeFileSync('../final.js', output)
